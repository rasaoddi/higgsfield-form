<script>
  const NGROK_BASE = "https://your-ngrok-url.ngrok-free.app"; // این را با URL خودت جایگزین کن

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const url = `${NGROK_BASE}/generate`;

    progressBox.style.display = 'block';
    videoBox.style.display = 'none';
    progressFill.style.width = '0%';

    let progress = 0;
    const fakeProgress = setInterval(() => {
      if (progress < 90) {
        progress += 1;
        progressFill.style.width = progress + '%';
      }
    }, 1000);

    try {
      const res = await fetch(url, {
        method: "POST",
        body: formData
      });

      clearInterval(fakeProgress);
      progressFill.style.width = '100%';

      const contentType = res.headers.get("content-type");
      if (contentType && contentType.includes("application/json")) {
        const data = await res.json();
        console.log('✅ Response from server:', data);

        if (data.success && data.videoUrl) {
          progressBox.style.display = 'none';
          videoBox.style.display = 'block';
          resultVideo.src = data.videoUrl;
          downloadLink.href = data.videoUrl;
        } else {
          alert("⚠️ خطا: " + (data.message || 'پاسخ نامعتبر از سرور.'));
        }
      } else {
        const text = await res.text();
        alert("⚠️ پاسخ JSON نبود:\n" + text);
      }
    } catch (err) {
      clearInterval(fakeProgress);
      alert("❌ خطا در اتصال به سرور:\n" + err.message);
      console.error(err);
    }
  });
</script>
